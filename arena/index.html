<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Arena: Survival Race</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="topbar">
    <div class="title">AI Arena: Survival Race (turrets)</div>

    <div class="controls">
      <button id="btnReset">Reset</button>
      <button id="btnPause">Pause</button>

      <label>Seed <input id="seed" value="1337" size="6" /></label>

      <label>Bot A
        <select id="botA">
          <option value="./bots/botA.js">botA.js</option>
          <option value="./bots/botB.js">botB.js</option>
          <option value="./bots/botML.js">botML.js</option>
        </select>
      </label>

      <label>Bot B
        <select id="botB">
          <option value="./bots/botB.js">botB.js</option>
          <option value="./bots/botA.js">botA.js</option>
          <option value="./bots/botML.js">botML.js</option>
        </select>
      </label>
      
      <label style="margin-left:8px;">
        <input type="checkbox" id="randomizeSides" checked /> Менять стороны A/B
      </label>
      <label style="margin-left:8px;">
        Карта
        <select id="mapSelect">
          <option value="0">Карта 1</option>
          <option value="1">Карта 2</option>
          <option value="2">Карта 3</option>
          <option value="3">Карта 4</option>
          <option value="4">Карта 5</option>
          <option value="random">Карта рандом</option>
        </select>
      </label>
      
      <label style="margin-left:12px;">Debug:
        <label><input type="checkbox" id="dbgRays" /> Rays</label>
        <label><input type="checkbox" id="dbgHits" /> Ray hits</label>
        <label><input type="checkbox" id="dbgInfo" /> Car info</label>
      </label>
      <label style="margin-left:8px;"> <input type="checkbox" id="dbgLogInput" /> Log input once</label>
      <label style="margin-left:8px;"><input type="checkbox" id="camAutoFollow" checked /> Auto follow</label>
      
      <div style="margin-top:8px; font-size:11px; color:#888;">
        Камера: прокрути колесо для zoom, правый клик+drag для pan
        <button id="btnZoomReset" style="margin-left:4px; padding:2px 6px; font-size:10px;">Сброс вида</button>
      </div>
    </div>
  </div>

   <div class="wrap">
     <canvas id="c" width="1280" height="720"></canvas>

     <div class="side">
       <div class="panel">
         <div class="h">Rules</div>
         <div class="p">Win: reach finish OR destroy opponent.</div>
         <div class="p">Turrets shoot both.</div>
         <div class="p">Bot API: decide(input) → { throttle, steer, shoot, aimAngle }</div>
       </div>
        <div style="display:flex; flex-direction:column; gap:4px; margin-top:8px;">
          <label><input type="checkbox" class="trainMapToggle" value="0" checked /> Карта 1</label>
          <label><input type="checkbox" class="trainMapToggle" value="1" checked /> Карта 2</label>
          <label><input type="checkbox" class="trainMapToggle" value="2" checked /> Карта 3</label>
          <label><input type="checkbox" class="trainMapToggle" value="3" checked /> Карта 4</label>
          <label><input type="checkbox" class="trainMapToggle" value="4" checked /> Карта 5</label>
          <label><input type="checkbox" class="trainMapToggle" value="random" /> Карта рандом</label>
        </div>

       <div class="panel">
         <div class="h">Fast Sim</div>
         <label>Num matches <input id="simMatches" value="100" size="4" type="number" min="1" max="10000" /></label>
         <label>Speed <input id="simSpeed" value="10" size="3" type="number" min="1" max="100" /></label>
         <button id="btnSimStart" style="margin-top:6px;">Start</button>
         <button id="btnSimStop" disabled>Stop</button>
         <pre id="simResults" style="font-size:11px; margin-top:6px;"></pre>
       </div>

       <div class="panel">
         <div class="h">Status</div>
         <pre id="status"></pre>
       </div>

       <div class="panel">
         <div class="h">Bot 3: Machine Learning</div>
         <div class="p">Экспериментальный бот с обучением. Прогресс сохраняется автоматически в браузере.</div>
         <button id="btnBot3Train">Начать обучение</button>
         <button id="btnBot3Reset" style="margin-left:6px;">Сбросить прогресс</button>
         <details open style="margin-top:10px;">
           <summary style="cursor:pointer;">Настройки обучения</summary>
           <div style="display:flex; flex-direction:column; gap:6px; margin-top:8px;">
             <label title="Сколько шагов собираем перед обновлением веса. Больше — стабильнее, но дольше.">
               Steps/batch <input id="bot3Steps" type="number" min="256" max="8192" step="128" value="2048" />
             </label>
             <label title="Скорость обучения PPO. Понижай, если reward скачет; повышай при стагнации.">
               Learning rate <input id="bot3Lr" type="number" step="0.0001" value="0.0005" />
             </label>
             <label title="Ограничение длины матча в секундах. Меньше — больше эпизодов, больше — больше времени для сложных сценариев.">
               Max match sec <input id="bot3MaxTime" type="number" min="10" max="180" step="5" value="90" />
             </label>
             <label title="Регулирует жадность политики. Высокое значение — больше экспериментов, низкое — стабильнее финальный стиль.">
               Entropy coef <input id="bot3Entropy" type="number" step="0.0005" value="0.003" />
             </label>
           </div>
         </details>
          <details style="margin-top:8px;">
            <summary style="cursor:pointer;">Настройки награды</summary>
            <div id="bot3RewardFields" style="display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:6px; margin-top:8px;"></div>
          </details>
        <canvas id="bot3Chart" width="280" height="110" style="width:100%; margin-top:8px; border:1px solid var(--stroke); border-radius:10px; background:rgba(0,0,0,0.15);"></canvas>
        <pre id="bot3Status" style="margin-top:6px;"></pre>
      </div>
     </div>
   </div>  <script type="module" src="./main.js"></script>
</body>
</html>
